@{
    ViewData["Title"] = "Admin - Bookings";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h3>Admin: Bookings</h3>

<div class="card p-3 mb-3">
    <div class="row g-2">
        <div class="col-md-3">
            <select id="status" class="form-select">
                <option value="">All</option>
                <option>Pending</option>
                <option>Accepted</option>
                <option>Rejected</option>
                <option>Confirmed</option>
                <option>Completed</option>
                <option>Cancelled</option>
            </select>
        </div>
        <div class="col-md-3">
            <input id="from" type="date" class="form-control" />
        </div>
        <div class="col-md-3">
            <input id="to" type="date" class="form-control" />
        </div>
        <div class="col-md-3">
            <input id="query" class="form-control" placeholder="Search (name/email/address)" />
        </div>
    </div>
    <div class="row g-2 mt-2">
        <div class="col-md-2">
            <button id="btnLoad" class="btn btn-primary w-100">Load</button>
        </div>
    </div>
</div>

<div id="msg"></div>
<div id="list"></div>

@section Scripts {
    <script>
        function load() {
            const status = $("#status").val();
            const from = $("#from").val();
            const to = $("#to").val();
            const query = $("#query").val();

            let url = "/api/admin/bookings?page=1&pageSize=50&";
            if (status) url += "status=" + status + "&";
            if (from) url += "from=" + from + "&";
            if (to) url += "to=" + to + "&";
            if (query) url += "query=" + encodeURIComponent(query) + "&";

            $.get(url)
                .done(function(res) {
                    const items = res.items || [];
                    if (!items.length) {
                        $("#list").html(`<div class="alert alert-warning">No bookings found.</div>`);
                        return;
                    }

                    let html = `<table class="table table-bordered">
                      <thead><tr>
                        <th>Id</th><th>Date</th><th>Time</th><th>Status</th><th>Parent</th><th>Sitter</th><th>Action</th>
                      </tr></thead><tbody>`;

                    items.forEach(b => {
                        html += `<tr>
                          <td>${b.id}</td>
                          <td>${b.bookingDate.substring(0,10)}</td>
                          <td>${b.startTime} - ${b.endTime}</td>
                          <td>${b.status}</td>
                          <td>${b.parent.fullName}</td>
                          <td>${b.sitter.fullName}</td>
                          <td><a class="btn btn-sm btn-outline-primary" href="/Web/AdminBookingDetails/${b.id}">Details</a></td>
                        </tr>`;
                    });

                    html += `</tbody></table>`;
                    $("#list").html(html);
                })
                .fail(function(xhr) {
                    showMsg("#msg", xhr.responseText || "Load failed", "err");
                });
        }

        $("#btnLoad").click(load);
        load();
    </script>
}