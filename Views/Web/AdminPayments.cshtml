@{
    ViewData["Title"] = "Admin - Payments";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h3>Admin: Payments</h3>

<div class="card p-3 mb-3">
    <div class="row g-2">
        <div class="col-md-3">
            <select id="status" class="form-select">
                <option value="">All</option>
                <option>Pending</option>
                <option>Paid</option>
                <option>Failed</option>
                <option>Refunded</option>
            </select>
        </div>
        <div class="col-md-2">
            <button id="btnLoad" class="btn btn-primary w-100">Load</button>
        </div>
    </div>
</div>

<div id="msg"></div>
<div id="list"></div>

@section Scripts {
    <script>
        function load() {
            const st = $("#status").val();
            const url = "/api/admin/payments" + (st ? ("?status=" + st) : "");

            $.get(url)
                .done(function(items) {
                    if (!items.length) {
                        $("#list").html(`<div class="alert alert-warning">No payments.</div>`);
                        return;
                    }

                    let html = `<table class="table table-bordered">
                      <thead><tr>
                        <th>Id</th><th>BookingId</th><th>Amount</th><th>Method</th><th>TxnId</th><th>Status</th><th>Created</th>
                      </tr></thead><tbody>`;

                    items.forEach(p => {
                        html += `<tr>
                          <td>${p.id}</td>
                          <td>${p.bookingId}</td>
                          <td>${p.amount}</td>
                          <td>${p.method}</td>
                          <td>${p.transactionId || ""}</td>
                          <td>${p.status}</td>
                          <td>${(p.createdAt || "").toString().substring(0,10)}</td>
                        </tr>`;
                    });

                    html += `</tbody></table>`;
                    $("#list").html(html);
                })
                .fail(function(xhr) {
                    showMsg("#msg", xhr.responseText || "Load failed", "err");
                });
        }

        $("#btnLoad").click(load);
        load();
    </script>
}